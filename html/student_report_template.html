<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>قالب تقرير الطالب | Student Report Template (Print to PDF)</title>
<style>
  :root{
    --brand:#2563eb;
    --ink:#111827;
    --muted:#6b7280;
    --ok:#16a34a;
    --warn:#f59e0b;
    --bad:#dc2626;
    --bg:#ffffff;
    --card:#f8fafc;
    --border:#e5e7eb;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family: "Segoe UI", Tahoma, Arial, sans-serif; line-height:1.45}
  .container{max-width:900px;margin:24px auto;padding:24px;background:#fff;border:1px solid var(--border);border-radius:16px}
  header{display:flex;gap:16px;align-items:center;margin-bottom:12px}
  .brand{width:72px;height:72px;border:2px dashed var(--border);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:12px;color:var(--muted)}
  h1{font-size:24px;margin:0}
  .subtitle{color:var(--muted);margin-top:4px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  label{font-size:12px;color:var(--muted)}
  input,select,textarea{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:#fff}
  textarea{min-height:80px;resize:vertical}
  .section{margin-top:18px;padding:16px;border:1px solid var(--border);border-radius:14px;background:var(--card)}
  .section h2{font-size:18px;margin:0 0 8px}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{border:1px solid var(--border);padding:10px;vertical-align:top}
  th{background:#eef2ff}
  .scale{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
  .scale button{border:1px solid var(--border);background:#fff;border-radius:8px;padding:6px 10px;cursor:pointer}
  .scale button.active{border-color:var(--brand);box-shadow:0 0 0 2px rgba(37,99,235,.15)}
  .kpi{display:flex;gap:6px;align-items:center}
  .kpi-bar{flex:1;height:8px;background:#e5e7eb;border-radius:999px;overflow:hidden}
  .kpi-bar > span{display:block;height:100%;background:var(--brand);width:0%}
  .muted{color:var(--muted)}
  .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:16px}
  .btn{border:1px solid var(--border);background:#fff;border-radius:10px;padding:10px 14px;cursor:pointer}
  .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
  .footer{display:flex;justify-content:space-between;gap:12px;margin-top:12px}
  .sign{flex:1;border-top:1px dashed var(--border);padding-top:6px;color:var(--muted);font-size:12px}
  .badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:11px;border:1px solid var(--border);background:#fff;color:var(--muted)}
  .consent{display:flex;gap:8px;align-items:center}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .row > div{flex:1;min-width:200px}
  @media print{
    .actions{display:none !important;}
    body{background:#fff}
    .container{border:none}
    @page{size:A4;margin:15mm}
  }
</style>
</head>
<body>
  <div class="container" id="report">
    <header>
      <div class="brand">LOGO</div>
      <div>
        <h1>تقرير الطالب | Student Learning Profile</h1>
        <div class="subtitle">نسخة للاطلاع التعليمي فقط — غير مخصَّصة للقرارات الإدارية/العقابية</div>
        <div class="subtitle">For educational guidance only — not for administrative/disciplinary decisions</div>
      </div>
    </header>

    <div class="section">
      <div class="grid">
        <div>
          <label>اسم الطالب / Student Name</label>
          <input id="student_name" placeholder="مثال: أحمد خالد / Ahmed Khaled">
        </div>
        <div>
          <label>المعرّف المستعار / Pseudonymous ID</label>
          <input id="student_id" placeholder="S-0001">
        </div>
        <div>
          <label>تاريخ الجلسة / Session Date</label>
          <input id="session_date" type="date">
        </div>
        <div>
          <label>الفصل/الصف / Grade</label>
          <input id="grade" placeholder="9 / 10 / 11">
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <div class="consent">
          <input type="checkbox" id="consent_chk">
          <label for="consent_chk">تم الحصول على موافقة وليّ الأمر والطالب (Written Consent obtained)</label>
        </div>
        <span class="badge">لا تُحفظ أصوات/صور — نصوص مشتقة فقط</span>
      </div>
    </div>

    <div class="section">
      <h2>المؤشرات الأساسية | Core Indicators (1–5)</h2>
      <table>
        <thead>
          <tr>
            <th>المؤشر | Indicator</th>
            <th>الوصف المختصر | Description</th>
            <th>الدرجة | Score</th>
            <th>دليل موجز | Evidence (snippet)</th>
          </tr>
        </thead>
        <tbody id="indicators_tbody">
          <!-- rows injected by JS -->
        </tbody>
      </table>
      <div class="row" style="margin-top:10px">
        <div class="kpi"><span class="muted">Communication Clarity</span><div class="kpi-bar"><span id="kpi_comm"></span></div></div>
        <div class="kpi"><span class="muted">Problem-Solving</span><div class="kpi-bar"><span id="kpi_prob"></span></div></div>
      </div>
    </div>

    <div class="section">
      <h2>نِطاقات الميول التعليمية | Learning Interests</h2>
      <textarea id="interests" placeholder="علوم، برمجة، تصميم… / Science, Coding, Design…"></textarea>
    </div>

    <div class="section">
      <h2>نِقاط القوة | Strengths</h2>
      <textarea id="strengths" placeholder="أمثلة سلوكية/لغوية تدعم نقاط القوة…"></textarea>
    </div>

    <div class="section">
      <h2>مجالات للتحسين | Areas to Improve</h2>
      <textarea id="improve" placeholder="أولويتان للتحسين مع أمثلة موجزة…"></textarea>
    </div>

    <div class="section">
      <h2>توصيات قابلة للتنفيذ (4–6 أسابيع) | Actionable Recommendations</h2>
      <textarea id="recs" placeholder="1) ... 2) ... 3) ... (SMART)"></textarea>
      <div class="muted" style="margin-top:6px">تُراجع التوصيات بعد أسبوعين — Review after 2 weeks</div>
    </div>

    <div class="footer">
      <div class="sign">توقيع المرشد / Advisor Signature</div>
      <div class="sign">توقيع الطالب / Student Signature</div>
      <div class="sign">توقيع وليّ الأمر / Guardian Signature</div>
    </div>

    <div class="actions">
      <button class="btn" onclick="loadSample()">تعبئة بيانات نموذجية</button>
      <label class="btn">
        تحميل بيانات JSON
        <input type="file" accept=".json" style="display:none" onchange="loadFromFile(event)">
      </label>
      <button class="btn" onclick="clearForm()">مسح الحقول</button>
      <button class="btn primary" onclick="window.print()">طباعة / تصدير PDF</button>
    </div>
  </div>

<script>
const INDICATORS = [
  { key:'communication', name_ar:'وضوح التواصل العلمي', name_en:'Communication Clarity', desc:'تنظيم الفكرة، استخدام أمثلة، ربط منطقي' },
  { key:'problem_solving', name_ar:'حلّ المشكلات', name_en:'Problem-Solving', desc:'تفكيك المسألة، التحقق من النتيجة' },
  { key:'task_focus', name_ar:'الانتباه للمهمّة', name_en:'Task Focus', desc:'الالتزام بالوقت وتقليل التشتّت' },
  { key:'strategy_flex', name_ar:'مرونة الاستراتيجية', name_en:'Strategy Flexibility', desc:'تجربة مسار بديل عند التعثّر' },
  { key:'collaboration', name_ar:'التعاون والتواصل', name_en:'Collaboration', desc:'الاستماع، تبادل الأدوار، احترام الدور' }
];

function renderIndicatorRows(){
  const tbody = document.getElementById('indicators_tbody');
  tbody.innerHTML = '';
  INDICATORS.forEach(ind => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><strong>${ind.name_ar}</strong><br><span class="muted">${ind.name_en}</span></td>
      <td>${ind.desc}</td>
      <td>
        <div class="scale" data-key="${ind.key}">
          ${[1,2,3,4,5].map(n=>`<button type="button" onclick="setScore('${ind.key}',${n},this)">${n}</button>`).join('')}
        </div>
      </td>
      <td><textarea id="ev_${ind.key}" placeholder="دليل موجز (اقتباس/سلوك)"></textarea></td>
    `;
    tbody.appendChild(tr);
  });
}
const scores = {};
function setScore(key, val, btn){
  scores[key] = val;
  const group = btn.parentElement;
  group.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  updateKpis();
}
function updateKpis(){
  const k1 = (scores['communication']||0) * 20;
  const k2 = (scores['problem_solving']||0) * 20;
  document.getElementById('kpi_comm').style.width = k1+'%';
  document.getElementById('kpi_prob').style.width = k2+'%';
}
function clearForm(){
  document.querySelectorAll('input,textarea').forEach(el=>{
    if(el.type==='checkbox'){ el.checked=false; } else { el.value=''; }
  });
  document.querySelectorAll('.scale button').forEach(b=>b.classList.remove('active'));
  Object.keys(scores).forEach(k=>delete scores[k]);
  updateKpis();
}
function loadSample(){
  const sample = {
    student_name:"أحمد خالد",
    student_id:"S-0007",
    session_date:new Date().toISOString().slice(0,10),
    grade:"10",
    consent:true,
    indicators:{
      communication:4, problem_solving:3, task_focus:5, strategy_flex:3, collaboration:4
    },
    evidence:{
      communication:"شرح الفرق بين السرعة المتجهة والسرعة القياسية مع مثال من كرة القدم",
      problem_solving:"قسّم المسألة إلى خطوات ورسم مخطط بسيط",
      task_focus:"التزم بالوقت وأنهى قبل الدقيقة الأخيرة",
      strategy_flex:"بدّل الطريقة بعد فشل المحاولة الأولى",
      collaboration:"استمع لزميله وأعاد صياغة اقتراحه"
    },
    interests:"علوم، برمجة، إلكترونيات – Science, Coding, Electronics",
    strengths:"تواصل مهذب، أمثلة واقعية، التزام بالمواعيد",
    improve:"يزيد التحقق من صحة النتائج؛ يدوّن خطوات الحلّ بوضوح أكبر",
    recs:"1) تمرين أسبوعي: حل مسألتين مع كتابة «سبب الاختيار».\n2) عرض شفهي 90 ثانية حول تجربة علمية.\n3) جلسة مراجعة بعد أسبوعين."
  };
  fillFromJson(sample);
}
function loadFromFile(ev){
  const f = ev.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = ()=>{
    try { const data = JSON.parse(reader.result); fillFromJson(data); }
    catch(e){ alert('ملف JSON غير صالح'); }
  };
  reader.readAsText(f,'utf-8');
}
function fillFromJson(data){
  document.getElementById('student_name').value = data.student_name||'';
  document.getElementById('student_id').value = data.student_id||'';
  document.getElementById('session_date').value = (data.session_date||'').slice(0,10);
  document.getElementById('grade').value = data.grade||'';
  document.getElementById('consent_chk').checked = !!data.consent;
  // scores
  document.querySelectorAll('.scale button').forEach(b=>b.classList.remove('active'));
  INDICATORS.forEach(ind=>{
    const v = data.indicators? data.indicators[ind.key] : undefined;
    if(v){ 
      scores[ind.key]=v; 
      const btn = document.querySelector(`.scale[data-key="${ind.key}"] button:nth-child(${v})`);
      if(btn) btn.classList.add('active');
    }
  });
  updateKpis();
  // evidence
  const evIds = {
    communication:'ev_communication',
    problem_solving:'ev_problem_solving',
    task_focus:'ev_task_focus',
    strategy_flex:'ev_strategy_flex',
    collaboration:'ev_collaboration'
  };
  if(data.evidence){
    Object.keys(evIds).forEach(k=>{
      const el = document.getElementById(evIds[k]);
      if(el) el.value = data.evidence[k]||'';
    });
  }
  document.getElementById('interests').value = data.interests||'';
  document.getElementById('strengths').value = data.strengths||'';
  document.getElementById('improve').value = data.improve||'';
  document.getElementById('recs').value = data.recs||'';
}
// Load data from URL ?data=base64(JSON)
function loadFromUrl(){
  const params = new URLSearchParams(window.location.search);
  const b64 = params.get('data');
  if(b64){
    try{
      const json = JSON.parse(atob(b64));
      fillFromJson(json);
    }catch(e){ console.warn('Cannot parse data param', e); }
  }
}
renderIndicatorRows();
loadFromUrl();
</script>
</body>
</html>
